# Tavern-py Commit 9767444 åŒæ­¥è¯„ä¼°

## Commit ä¿¡æ¯
- **Hash**: 976744469dd9367839531435fdf545b69a1d03b1
- **ä½œè€…**: Michael Boulton <boulton@zoetrope.io>
- **æ—¥æœŸ**: 2018-02-13
- **æè¿°**: Add schema for mqtt client block

## å˜æ›´å†…å®¹

### æ–‡ä»¶å˜æ›´
- `tavern/mqtt.py`: æ³¨é‡Šæ‰äº†ä¸€äº›ä¸å¸¸ç”¨çš„ MQTT å®¢æˆ·ç«¯é…ç½®é¡¹
- `tavern/schemas/tests.schema.yaml`: æ–°å¢ 50 è¡Œï¼ˆ**æ–°å¢ MQTT schema**ï¼‰

## ä¸»è¦å˜æ›´

### 1. æ–°å¢ MQTT é…ç½®çš„ Schema éªŒè¯

åœ¨ `tests.schema.yaml` ä¸­æ·»åŠ äº† `mqtt` é…ç½®å—çš„å®Œæ•´ schemaï¼š

```yaml
mqtt:
  client:
    client_id: str
    clean_session: bool
    transport: enum[tcp, websockets]
  connect:
    host: str (required)
    port: int
    keepalive: int
  tls:
    enable: bool
```

### 2. ç®€åŒ– MQTT å®¢æˆ·ç«¯é…ç½®

æ³¨é‡Šæ‰äº†ä¸å¸¸ç”¨çš„é…ç½®é¡¹ï¼š
- `userdata`: éš¾ä»¥ä½¿ç”¨
- `protocol`: å¼ºåˆ¶ä½¿ç”¨ mqttv311

## å˜æ›´ç›®çš„

ä¸º MQTT åè®®æ”¯æŒæ·»åŠ  **Schema éªŒè¯**ï¼Œç¡®ä¿ï¼š
1. âœ… MQTT é…ç½®æ ¼å¼æ­£ç¡®
2. âœ… å¿…å¡«å­—æ®µå­˜åœ¨ï¼ˆå¦‚ `connect.host`ï¼‰
3. âœ… æšä¸¾å€¼æ­£ç¡®ï¼ˆå¦‚ `transport` åªèƒ½æ˜¯ tcp æˆ– websocketsï¼‰
4. âœ… ç±»å‹æ­£ç¡®ï¼ˆå¦‚ `port` å¿…é¡»æ˜¯ intï¼‰

## Tavern-go åŒæ­¥è¯„ä¼°

### âŒ æš‚ä¸åŒæ­¥

**ç†ç”±**:

1. **MQTT åŠŸèƒ½æœªå®ç°**
   - è¿™æ˜¯ MQTT æ”¯æŒçš„ç¬¬ä¸‰éƒ¨åˆ†ï¼ˆSchema éªŒè¯ï¼‰
   - tavern-go ä¸æ”¯æŒ MQTT åè®®
   - æš‚æ— éœ€æ±‚

2. **Go çš„ Schema éªŒè¯æ–¹å¼ä¸åŒ**
   - tavern-py ä½¿ç”¨ YAML schema æ–‡ä»¶
   - tavern-go ä½¿ç”¨ Go struct tags éªŒè¯
   - å½“å®ç° MQTT æ—¶ï¼Œç›´æ¥åœ¨ Go struct ä¸­å®šä¹‰å³å¯

### ğŸ“‹ æœªæ¥å®æ–½å‚è€ƒ

å¦‚æœéœ€è¦æ·»åŠ  MQTT æ”¯æŒï¼ŒGo struct å®šä¹‰å¦‚ä¸‹ï¼š

```go
// pkg/schema/types.go
type TestSpec struct {
    TestName string
    Stages   []Stage
    MQTT     *MQTTConfig `yaml:"mqtt,omitempty" json:"mqtt,omitempty"`
}

type MQTTConfig struct {
    Client  *MQTTClient  `yaml:"client,omitempty"`
    Connect MQTTConnect  `yaml:"connect"`           // required
    TLS     *MQTTTls     `yaml:"tls,omitempty"`
}

type MQTTClient struct {
    ClientID     string `yaml:"client_id,omitempty"`
    CleanSession bool   `yaml:"clean_session,omitempty"`
    Transport    string `yaml:"transport,omitempty"` // tcp or websockets
}

type MQTTConnect struct {
    Host      string `yaml:"host"`                    // required
    Port      int    `yaml:"port,omitempty"`
    Keepalive int    `yaml:"keepalive,omitempty"`
}

type MQTTTls struct {
    Enable bool `yaml:"enable,omitempty"`
}
```

## ç»“è®º

- **åŒæ­¥çŠ¶æ€**: âŒ æš‚ä¸åŒæ­¥
- **éœ€è¦æ“ä½œ**: æ— 
- **ä¼˜å…ˆçº§**: ä½ï¼ˆMQTT åŠŸèƒ½æœªå®ç°ï¼‰
- **ä¾èµ–**: éœ€è¦å…ˆå®ç° commit a4ae88fï¼ˆMQTT å“åº”éªŒè¯ï¼‰

## å¤‡æ³¨

- è¿™æ˜¯ MQTT æ”¯æŒç³»åˆ—çš„ç¬¬ä¸‰ä¸ª commit
- åªæ·»åŠ äº† schema éªŒè¯ï¼Œæ²¡æœ‰åŠŸèƒ½å®ç°
- tavern-go ä½¿ç”¨ Go struct tags å®ç°ç›¸åŒåŠŸèƒ½
- å½“å®ç° MQTT æ—¶ï¼Œè¿™ä¸ª schema å¯ä½œä¸ºå‚è€ƒ
